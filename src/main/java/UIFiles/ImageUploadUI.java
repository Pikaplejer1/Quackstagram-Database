package UIFiles;import Database.PostDatabase;import Database.UpdateCredentials;import MainFiles.FilePathInstance;import MainFiles.User;import javax.swing.*;import java.awt.*;import java.awt.event.ActionEvent;import java.io.BufferedReader;import java.io.BufferedWriter;import java.io.File;import java.io.IOException;import java.nio.file.*;import java.time.LocalDateTime;import java.time.format.DateTimeFormatter;/** * Provides the user interface for uploading images to Quackstagram. * It includes functionalities for selecting, previewing, and uploading images along with a bio. */public class ImageUploadUI extends BaseUI {    private JLabel imagePreviewLabel;    private JTextArea bioTextArea;    private JButton uploadButton;    private JButton saveButton;    private boolean imageUploaded = false;    private JPanel headerPanel;    private JLabel photoPanel;    private JPanel navigationPanel;    private JPanel contentPanel;    private ImageIcon emptyImageIcon;    private JScrollPane bioScrollPane;    private JPanel uploadButtonPanel;    private final FilePathInstance pathFile = FilePathInstance.getInstance();    /**     * Constructor for ImageUploadUI.     * Initializes the components and layout for the image upload interface.     */    public ImageUploadUI() {        super("Upload Image");        initializeComponents();        layoutComponents();    }    /**     * Initializes the components for the image upload interface.     */    private void initializeComponents() {        headerPanel = createHeaderPanel("upload image");        navigationPanel = createNavigationPanel();        photoPanel = createPicture("img/logos/DACS.png");        contentPanel = createContentPanel();        imagePreviewLabel = createImagePreviewLabel();        bioTextArea = createBioTextArea();        bioScrollPane = createBioScrollPane();        uploadButton = createButton("Upload Image", Color.YELLOW);        uploadButtonPanel = CreateUploadButtonPanel();        saveButton = createSaveButton();    }    /**     * Lays out the components on the UI.     */    private void layoutComponents() {        this.add(headerPanel);        contentPanel.add(photoPanel);        contentPanel.add(imagePreviewLabel);        contentPanel.add(uploadButtonPanel);        add(headerPanel, BorderLayout.NORTH);        add(contentPanel, BoxLayout.Y_AXIS);        add(navigationPanel, BorderLayout.SOUTH);    }    private JPanel CreateUploadButtonPanel() {        uploadButtonPanel = new JPanel();        uploadButtonPanel.add(uploadButton);        uploadButton.addActionListener(this::uploadAction);        return uploadButtonPanel;    }    private JScrollPane createBioScrollPane() {        bioScrollPane = new JScrollPane(bioTextArea);        bioScrollPane.setPreferredSize(new Dimension(WIDTH - 50, HEIGHT / 6));        contentPanel.add(bioScrollPane);        return bioScrollPane;    }    private JTextArea createBioTextArea() {        bioTextArea = new JTextArea();        bioTextArea.setAlignmentX(CENTER_ALIGNMENT);        bioTextArea.setLineWrap(true);        bioTextArea.setWrapStyleWord(true);        addHoverText(bioTextArea,"Enter a caption");        return bioTextArea;    }    private JLabel createImagePreviewLabel() {        imagePreviewLabel = new JLabel();        imagePreviewLabel.setAlignmentX(CENTER_ALIGNMENT);        imagePreviewLabel.setPreferredSize(new Dimension(WIDTH, HEIGHT / 2));        imagePreviewLabel.setIcon(emptyImageIcon);        return imagePreviewLabel;    }    private JButton createSaveButton() {        // Save button (for bio)        saveButton = createButton("Save Caption", Color.WHITE);        saveButton.setAlignmentX(CENTER_ALIGNMENT);        saveButton.addActionListener(this::saveBioAction);        return saveButton;    }    /**     * Handles the action of uploading an image.     *     * @param event The action event associated with the upload action.     */    private void uploadAction(ActionEvent event) {        JFileChooser fileChooser = configureFileChooser();        int returnValue = fileChooser.showOpenDialog(null);        if (returnValue == JFileChooser.APPROVE_OPTION) {            File selectedFile = fileChooser.getSelectedFile();            try {                handleImageUpload(selectedFile);            } catch (IOException ex) {                JOptionPane.showMessageDialog(this, "Error saving image: " + ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);            }        }    }    /**     * Handles the process of selecting and uploading an image file.     *     * @param selectedFile The selected image file.     * @throws IOException If an error occurs during file handling.     */    private void handleImageUpload(File selectedFile) throws IOException {        PostDatabase postDatabase = new PostDatabase();        int imageId = postDatabase.getPostId();        String fileExtension = getFileExtension(selectedFile);        User currentUser = User.getInstance();        String newFileName = currentUser.getUsername() + "_" + imageId + "." + fileExtension;        Path destPath = saveFileToDirectory(selectedFile, currentUser.getUsername(), newFileName);        // Save the bio and image ID to the database//        savePhotoDir(username + "_" + imageId, username, bioTextArea.getText());        postDatabase.savePfpDir(currentUser.getUsername(),imageId, bioTextArea.getText(),newFileName);        // Load the image from the saved path        calculateImageDimensions(destPath, imagePreviewLabel);        // Update the flag to indicate that an image has been uploaded        imageUploaded = true;        // Change the text of the upload button        uploadButton.setText("Upload Another Image");        JOptionPane.showMessageDialog(this, "Image uploaded and preview updated!");    }    private Path saveFileToDirectory(File selectedFile, String username, String newFileName) throws IOException {        Path destPath = Paths.get("posts", username, newFileName);        Files.copy(selectedFile.toPath(), destPath, StandardCopyOption.REPLACE_EXISTING);        return destPath;    }    public static String getFileExtension(File file) {        String name = file.getName();        int lastIndexOf = name.lastIndexOf(".");        if (lastIndexOf == -1) {            return ""; // empty extension        }        return name.substring(lastIndexOf + 1);    }    /**     * Handles the action of saving the bio text.     *     * @param event The action event associated with saving the bio.     */    private void saveBioAction(ActionEvent event) {        // Here you would handle saving the bio text        String bioText = bioTextArea.getText();        // For example, save the bio text to a file or database        JOptionPane.showMessageDialog(this, "Caption saved: " + bioText);    }}